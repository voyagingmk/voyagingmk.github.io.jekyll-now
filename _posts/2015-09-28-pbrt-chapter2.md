---
layout: post_latex
title: PBRT《章2》阅读笔记
published: true
tags: ['c++', 'pbrt']
---


最近在看线代的公开课，顺便也把PBRT这个坑开了，合在一起学。

本文的cpp代码均来自[https://github.com/mmp/pbrt-v2](https://github.com/mmp/pbrt-v2)，木有修改。只为方便读者阅读。

## 正文

一个基本的渲染器，需要实现2点：输入场景数据、输出渲染图像。

输入场景数据这一步，就需要对3D世界各种东西进行抽象、并设计各种数据结构，比如比较fundamental的：3D空间向量、3D坐标系系统、光线，或者visible的：各种2D/3D几何体、纹理系统等。大概就是，这个渲染器要渲染的东西，程序上都会有一些对应的代码。渲染器不可能对未知的东西进行渲染。比如毛发、布这种高端的东西，一个基本的渲染器是无法渲染的，除非你写了一些代码来完成这个事情。

《PBRT》第二章就讲了这些基础的东西。


在前面的线代的文章中，提到了矩阵的基(basis)的概念。矩阵的基是一组线性无关的列向量，这个矩阵的列空间的任意一点，可以通过对矩阵的基的线性组合得到。

那么n维的情况下，定义一个向量的公式是：

\\[ v = s\_\{1\}v\_\{1\} + \\cdots + s\_\{n\}v\_\{n\} \\]

定义一个点的位置的公式是：

\\[ p = p\_\{0\} + s\_\{1\}v\_\{1\} + \\cdots + s\_\{n\}v\_\{n\} \\]

对于渲染器的3维空间，要简化成：

\\[ p\_\{0\} = (0,0,0) \\]
\\[ basis = (1,0,0) (0,1,0) (0,0,1) \\]

这3个标准基向量对应的空间被称为世界空间(world space)。


### 向量(vector)、点(point)的区别

向量和点，区别在于点没有长度的概念，也就是说点是零维的，点代表空间里的一个**位置**（pbrt的Point和Vector的差异是没有LengthSquared、Length函数)，而向量没有起点的概念，向量只是指明了一个**方向**并且有长度。


### 3维空间下，如何从一个向量出发，构造出一组标准正交基

注意，这个问题是有重要意义的，因为一组标准正交基相当于一个坐标系。

- 设\\( v\_\{1\}=(x\_\{1\},y\_\{1\},z\_\{1\}) \\)，并且v1已经单位化

- 随便选择v1的某一个分量，并将它变成0，再交换剩余的2个分量的位置，并对其中一个分量取反，就能得到和v1正交的v2。这是因为这样构造出来的v2，必然使得\\(  v\_\{1\}\\cdot v\_\{2\}=0 \\)。比如当\\( v\_\{2\}=(-z\_\{1\},0,x\_\{1\}) \\)时，有\\( v\_\{1\}\\cdot v\_\{2\}=(x\_\{1\},y\_\{1\},z\_\{1\})\\cdot (-z\_\{1\},0,x\_\{1\}) = 0\\)
- 上面的v2还有不足，因它不是单位化的。单位化的v2应该是\\[v\_\{2\}=\\dfrac \{ (-z\_\{1\},0,x\_\{1\}) \}\{ \\sqrt \{z\_\{1\}\^\{1\}+x\_\{1\}\^\{1\}\}\} \\]
- 有了v1、v2后，v3就等于v1和v2的叉积(cross product): \\( v\_\{3\} =v\_\{1\} \\times v\_\{2\} \\)