---
layout: post_latex
title: redis5.0源码学习笔记（2）对象实现
tags: ['redis']
published: true
---

Note：本文实际绑定的版本是branch5.0（2018-7-25）。

(更新中)

<!--more-->


## 对象是什么

上一篇文章中，介绍了redis的各种基础数据结构，实际上，那些数据结构不是直接对应到那些redis指令的，而是加了一层object层，每种object可以用特定的1种或多种基础数据结构来实现。

## 对象类型

总共有5种：

```c
/* The actual Redis Object */
#define OBJ_STRING 0    /* String object. */
#define OBJ_LIST 1      /* List object. */
#define OBJ_SET 2       /* Set object. */
#define OBJ_ZSET 3      /* Sorted set object. */
#define OBJ_HASH 4      /* Hash object. */
```

## 对象编码

```c
#define OBJ_ENCODING_RAW 0     /* 什么数据结构都没用到 */
#define OBJ_ENCODING_INT 1     /* 整数 */
#define OBJ_ENCODING_HT 2      /* 散列表 */
#define OBJ_ENCODING_ZIPMAP 3  /* zipmap */
#define OBJ_ENCODING_LINKEDLIST 4 /* 已废弃 */
#define OBJ_ENCODING_ZIPLIST 5 /* ziplist */
#define OBJ_ENCODING_INTSET 6  /* intset */
#define OBJ_ENCODING_SKIPLIST 7  /* skiplist */
#define OBJ_ENCODING_EMBSTR 8  /* 嵌入式sds */
#define OBJ_ENCODING_QUICKLIST 9 /* 由多个ziplist组成的链表（linked list） */
#define OBJ_ENCODING_STREAM 10 /* radix tree of listpacks */
```

## 对象结构体

```c
typedef struct redisObject {
    unsigned type:4; // 上文已介绍
    unsigned encoding:4; // 上文已介绍
    unsigned lru:LRU_BITS; // 计时的
    int refcount;
    void *ptr;
} robj;
```