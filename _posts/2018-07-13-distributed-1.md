---
layout: post_latex
title: 分布式杂谈
tags: ['server']
published: true
---

<!--more-->

### 分布式中心化/去中心化

既然分布式了为什么还有中心化？其中关键是简化了中心节点的任务，中心节点是作为任务派发者、网络管理者存在的，类似领导和员工的关系。

领导节点可能是所有节点一起选举出来的，而不是固定的。从而避免领导节点故障导致整个网络崩溃。

例子是raft算法。

### 分布式一致性

一致性是指所有节点的数据状态一致。一般是用来做大型数据库的多机备份和海量服务。多机备份使得单个数据库节点坏了，还有别的数据库可用，数据不易丢失；海量服务是指，既然可以保证多个数据库节点是一致的，那么数据库节点越多，能服务于用户的能力越强，因为用户可以任意选择一个节点存取数据。

一致性算法：paxos、raft。

因为节点之间的同步存在网络延迟，故一致性要分强弱：

- 强一致：强调读操作读到的肯定是最新的值，即写操作同步到整个网络前，读操作是要阻塞的。
- 弱一致：单机写入后，不保证其他节点可以立即读到最新的值，也不保证多久之后数据能够达到一致，只是尽可能保证某个时间级别后（秒），能够一致。
- 最终一致：弱一致的特例，保证会在一定时间内，能够达到一致。

### 分布式缓存

## LFU和LRU

Least Frequently Used（LFU），计算使用频率，优先淘汰最不常用的缓存条目。

Least Recently Used（LRU），淘汰最近最少使用的条目。


### 分布式锁


### 节点互访：RPC

功能：

- 远程调用
- 服务注册
- 服务发现
- 服务监控

最基础的：

- 稳定
- 高性能
- 多语言

### 微服务

### 对象序列化技术

最普通的：JSON

更高级的：MessagePack、Protocol Buffers、FlatBuffers。

### 消息队列

### 分布式数据库拆分

先垂直拆分：不同服务的数据(库)要相互隔离，不要放一起。

后水平拆分：隔离后，单机数据库如果遇到瓶颈，就拆成多机（分片）。

水平拆分会遇到问题：没有一个唯一的入口，来操作数据库。

解决方案：

- 客户端来实现数据路由：客户端自己决定连接哪个数据库节点，存什么数据。缺点是
- 中间件：把多机数据库封装成单机的使用方法，客户端操作起来和单机一样，简单很多





