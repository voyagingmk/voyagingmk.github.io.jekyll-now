---
layout: post_latex
title: 关于c++11的一些特性(2) 完美转发
published: true
tags: ['c++']
---

<!--more-->

测试代码:

{% highlight cpp linenos %}

#include <stdio.h>
#include <vector>
using namespace std;


class Item {
public:
	char name;
	int val;
public:
	~Item() {
		printf("[dtor called] (%c, %i)\n", name, val);
	}
	Item() :name('_'), val(0) {
		printf("[default ctor called] \n");
	}

	Item(char n, int v) :name(n), val(v) {
		printf("[ctor called] (%c, %i)\n", name, val);
	}
	Item(Item&& a) {
		printf("[move ctor called] (%c, %i)\n", a.name, a.val);
		name = a.name;
		val = a.val;
	}
};


int main() {
	vector<Item> v1;
	for (int i = 0; i < 3; i++) {
		v1.emplace_back('a', i);
	}
	printf("-----------------------\n");
	vector<Item> v2;
	v2.reserve(10);
	for (int i = 0; i < 3; i++) {
		v2.emplace_back('b', i);
	}
	printf("-----------------------\n");
	vector<Item> v3;
	v3.push_back({ 'c', 3 });
	printf("-----------------------\n");
	return 0;
}
{% endhighlight %}

{% highlight cpp linenos %}
[ctor called] (a, 0)
[move ctor called] (a, 0)
[dtor called] (a, 0)
[ctor called] (a, 1)
[move ctor called] (a, 0)
[move ctor called] (a, 1)
[dtor called] (a, 0)
[dtor called] (a, 1)
[ctor called] (a, 2)
-----------------------
[ctor called] (b, 0)
[ctor called] (b, 1)
[ctor called] (b, 2)
-----------------------
[ctor called] (c, 3)
[move ctor called] (c, 3)
[dtor called] (c, 3)
-----------------------
[dtor called] (c, 3)
[dtor called] (b, 0)
[dtor called] (b, 1)
[dtor called] (b, 2)
[dtor called] (a, 0)
[dtor called] (a, 1)
[dtor called] (a, 2)

{% endhighlight %}


## 参考资料

[http://eli.thegreenplace.net/2014/perfect-forwarding-and-universal-references-in-c/](http://eli.thegreenplace.net/2014/perfect-forwarding-and-universal-references-in-c/)
