---
layout: post_latex
title: PBR渲染原理
tags: ['computer graphics']
published: true
---

基于PBR做渲染，需要涉及到很多物理学、几何学、热辐射学概念，本文将逐一介绍每个关键概念，并给出相关重要公式。

<!--more-->

## 微平面(microfacets)理论

微观尺度下的任意一个平面(surface)都可以用多个微小的、完美反射的镜面来描述，这些微小镜面被称为**微平面**。

### 粗糙度(roughness)

平面的**粗糙度**决定了它的各个微平面的镜面反射情况：

![1.png](../images/2017.9/1.png)

粗糙度可以用0.0到1.0来近似。

### 中间方向矢量(halfway vector)

halfway vector(简称h)等于光线方向矢量l加上视角方向矢量v并单位化（即处于l和v的中间）：

\\[ \\mathbf h = \\frac \{ \\mathbf l + \\mathbf v\}\{ \parallel \\mathbf l + \\mathbf v \parallel \} \\]

![2.png](../images/2017.9/2.png)

 h的特性是：h与平面法线越靠近，那么镜面光越强。

 在这个微平面理论下，可以推出：**越多的微平面的法线与h对齐，这个平面的镜面反射就会越强**。


## 能量守恒(energy conservation)

不考虑自发光的平面，所有平面的出射光能量总和不能高于入射光能量总和。

观察下图，可以发现一个规律，粗糙度越高、镜面反射区域越大、镜面反射区域亮度越低。如果反射区域变大，然而亮度不变，那说明能量不守恒了。

![3.png](../images/2017.9/3.png)

在渲染里，简单地说，要做到能量守恒，就是要遵守一个原则：**平面接收到的光能量要么被反射，要么被吸收**，也就是说，吸收和反射，是互斥关系。

直接反射出去的光能量，也叫镜面光、反射光；吸收的光能量，大部分也会变成光发射出去（真正被吸收的就变成热能了），叫漫反射光、折射光。

镜面/反射光、漫反射/折射光的能量可以用2个系数kS、kD控制，两者满足关系式kD + kS = 1、kD > 0、kS > 0，从而确保发射的光能量不超过接收的光能量。

## 渲染方程

渲染方程的详细讨论已经写在[渲染基础理论的介绍](http://www.qiujiawei.com/rendering-equation/)一文。

## cook-Torrance BRDF



